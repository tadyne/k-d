<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" href="https://www.patternsgameprog.com/discover-python-and-patterns-14-collisions" />
<meta name="description" content="Sprite collisions with Python and Pygame.">
<meta name="author" content="Philippe-Henri Gosselin">
<meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' />
<link rel="icon" href="assets/img/favicon.ico">
<title>Design Patterns and Video Games</title>
<link href="https://www.patternsgameprog.com/assets/css/bootstrap.min.css" rel="stylesheet">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Righteous" rel="stylesheet">
<link href="https://www.patternsgameprog.com/assets/css/mediumish.css" rel="stylesheet">
<link href="https://www.patternsgameprog.com/assets/css/darcula.css" rel="stylesheet">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150349446-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150349446-1');
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NB1HVSF9XH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NB1HVSF9XH');
</script>

<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

</head>
<body>

<!-- Begin Nav
================================================== -->
<nav class="navbar navbar-toggleable-md navbar-light bg-white fixed-top mediumnavigation">
<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon"></span>
</button>
<div class="container">
	<a class="navbar-brand" href="https://www.patternsgameprog.com">
	Design Patterns and Video Games
	</a>
	
	<div class="collapse navbar-collapse" id="navbarsExampleDefault">
		<ul class="navbar-nav ml-auto">
						<li class="nav-item">
			<a class="nav-link" href="https://www.patternsgameprog.com/series">Series</a>
			</li>
						<li class="nav-item">
			<a class="nav-link" href="https://www.patternsgameprog.com/more">More</a>
			</li>
						<li class="nav-item">
			<a class="nav-link" href="https://www.patternsgameprog.com/about">About</a>
			</li>
									
		</ul>
	</div>
</div>
</nav>
<!-- End Nav
================================================== -->



<div class="container">
	<div class="mainheading">
		<img class="featured-image img-fluid" src="https://www.patternsgameprog.com/assets/img/header.png" alt="Design Patterns and Video Games">
	</div>
<!-- End Site Title
================================================== -->

	<div class="section-title">
		<h2><span>Discover Python and Patterns (14): Collisions</span></h2>
	</div>

<p>In this post, I add enemies and I show you how to test if the tank collides one of them.</p>
<p><em>This post is part of the <a href="https://www.patternsgameprog.com/series/discover-python-and-patterns/">Discover Python and Patterns series</a></em> </p>
<h2>Objective</h2>
<p>I propose to add two towers at locations (10,3) and (10,5). I use two sprites to draw them, one for the base, and the other for the gun:</p>
<figure><img alt="Pygame tank with two towers" class="centered-image img-fluid" src="https://www.patternsgameprog.com/media/pages/discover-python-and-patterns-14-collisions/4b92090a16-1621709101/14_towers-1024x671.png" width="678"></figure>
<p>Locations are cell coordinates, from left to right (x coordinate) and from top to bottom (y coordinate). The lower coordinate value is 0, and the highest one is the width or height of the world minus one. So, with a world of 16 per 10 cells, the x coordinate goes from 0 to 15, and the y coordinate goes from 0 to 9:</p>
<figure><img alt="Pygame world grid" class="centered-image img-fluid" src="https://www.patternsgameprog.com/media/pages/discover-python-and-patterns-14-collisions/49d2199593-1621709101/14_grid-1024x671.png" width="704"></figure>
<p>Looking at this screenshot, you can say that the tank is at the location (5,4).</p>
<h2>Program structure</h2>
<p>I still use the two classes from the <a href="https://www.patternsgameprog.com/discover-python-and-patterns-13-sprites/">previous post</a>:</p>
<figure><img alt="Pygame class diagram" class="centered-image img-fluid" src="https://www.patternsgameprog.com/media/pages/discover-python-and-patterns-14-collisions/3a363a5431-1621709101/14_class_diagram-1024x436.png" width="569"></figure>
<p>I created two new attributes in the <code>GameState</code> class:</p>
<ul>
<li>New attribute <code>tower1Pos</code>: the location of the first tower</li>
<li>New attribute <code>tower2Pos</code>: the location of the second tower</li>
</ul>
<h2>Add towers to the world</h2>
<p>As in the previous posts, I put all the data related to the world into an instance of the <code>GameState</code>. I initialize this data in the constructor the <code>GameState</code> class:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
    self.worldSize = Vector2(<span class="hljs-number">16</span>,<span class="hljs-number">10</span>)
    self.tankPos = Vector2(<span class="hljs-number">5</span>,<span class="hljs-number">4</span>)
    self.tower1Pos = Vector2(<span class="hljs-number">10</span>,<span class="hljs-number">3</span>)
    self.tower2Pos = Vector2(<span class="hljs-number">10</span>,<span class="hljs-number">5</span>)      </code></pre>
<h2>Draw a tower</h2>
<p>The drawing of a tower is similar to the one we did for the tank:</p>
<pre class="hljs"><code>spritePoint = self.gameState.tower1Pos.elementwise()*self.cellSize
texturePoint = Vector2(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>).elementwise()*self.cellSize
textureRect = Rect(int(texturePoint.x), int(texturePoint.y), int(self.cellSize.x),int(self.cellSize.y))
self.window.blit(self.unitsTexture,spritePoint,textureRect)
texturePoint = Vector2(<span class="hljs-number">0</span>,<span class="hljs-number">6</span>).elementwise()*self.cellSize
textureRect = Rect(int(texturePoint.x), int(texturePoint.y), int(self.cellSize.x),int(self.cellSize.y))
self.window.blit(self.unitsTexture,spritePoint,textureRect)</code></pre>
<p>Let's take this process line by line. The first line creates a variable <code>spritePoint</code> that contains the pixel location on the screen, where the sprite appears:</p>
<pre class="hljs"><code>spritePoint = self.gameState.tower1Pos.elementwise()*self.cellSize</code></pre>
<p>The two variables in the multiplication are Pygame <code>Vector2</code> instances: it is like tuples of two floats (x,y), except that there are many nice features to ease computations. For instance, if you use the <code>elementwise()</code> method like in the line above, it allows you to do an element-wise multiplication:</p>
<pre class="hljs"><code>spritePoint = Vector2()
spritePoint.x = self.gameState.tankPos.x * self.cellSize.x
spritePoint.y = self.gameState.tankPos.y * self.cellSize.y</code></pre>
<p>As a result, it reduces three lines of code into one.</p>
<p>The second line of the drawing of a tower computes the pixel location of the tower sprite in the image tileset:</p>
<pre class="hljs"><code>texturePoint = Vector2(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>).elementwise()*self.cellSize</code></pre>
<p>This sprite is in the first column of the second row of the tile, so cell coordinates (0,1). If the pixel size of cells is (64,64), then the pixel location of this sprite if (0,64).</p>
<p>The third line creates a Pygame <code>Rect</code> instance with the rectangle that contains the tower sprite in the tileset:</p>
<pre class="hljs"><code>textureRect = Rect(int(texturePoint.x), int(texturePoint.y), int(self.cellSize.x),int(self.cellSize.y))</code></pre>
<p>We must convert float values into integer values: to do so, you can use the <code>int</code> type as if it was a function. Then, <code>int(x)</code> is the cast of <code>x</code> into an <code>int</code>.</p>
<p>The fourth line draws the sprite on screen:</p>
<pre class="hljs"><code>self.window.blit(self.unitsTexture,spritePoint,textureRect)</code></pre>
<p>The <code>blit()</code> method from the Pygame <code>Surface</code> class (what is <code>self.window</code>) needs three arguments: the tileset (here <code>self.unitsTexture</code>), the pixel location on the screen (here <code>spritePoint</code>), and the rectangle that contains the sprite in the tileset (here <code>textureRect</code>).</p>
<p>The last lines are very similar to the first ones, except that we don't recompute <code>spritePoint</code>: the aim is to draw a gun at the same location. These lines are a copy of lines 2-4, with a change for the location of the sprite: it is a gun sprite at (0,6) instead of a tower base sprite at (0,1).</p>
<h2>Collisions</h2>
<p>If you add the previous changes in the program, then you will see the two towers on the screen. However, if you move the tank, it can go over the towers.</p>
<p>In the previous program, we were already testing tank locations. More specifically, we forbid it to go outside the world:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self,moveTankCommand)</span>:</span>
    self.tankPos += moveTankCommand

    <span class="hljs-keyword">if</span> self.tankPos.x &lt; <span class="hljs-number">0</span>:
        self.tankPos.x = <span class="hljs-number">0</span>
    <span class="hljs-keyword">elif</span> self.tankPos.x &gt;= self.worldSize.x:
        self.tankPos.x = self.worldSize.x - <span class="hljs-number">1</span>

    <span class="hljs-keyword">if</span> self.tankPos.y &lt; <span class="hljs-number">0</span>:
        self.tankPos.y = <span class="hljs-number">0</span>
    <span class="hljs-keyword">elif</span> self.tankPos.y &gt;= self.worldSize.y:
        self.tankPos.y = self.worldSize.y - <span class="hljs-number">1</span></code></pre>
<p>With this approach, the tank location is first updated (line 2) and then corrected if wrong (lines 4-11). It works fine in the case where the world is empty. If it is not the case, we can't be sure that the corrected location is empty!</p>
<p>Another approach is first to compute the targetted location, and then update the true location if it is correct:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self,moveTankCommand)</span>:</span>
    newTankPos = self.tankPos + moveTankCommand

    <span class="hljs-keyword">if</span>  newTankPos.x &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> newTankPos.x &lt; self.worldSize.x \
    <span class="hljs-keyword">and</span> newTankPos.y &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> newTankPos.y &lt; self.worldSize.y \
    <span class="hljs-keyword">and</span> newTankPos != self.tower1Pos <span class="hljs-keyword">and</span> newTankPos != self.tower2Pos:
        self.tankPos = newTankPos</code></pre>
<p>The second line stores the target location in <code>newTankPos</code>. Then, all the remaining lines is a long <code>if</code>statement that does all the checks. Note that there is a backslash <code>\</code> at the end of lines 4 and 5: this is to split the long statement into multiple lines to make it more readable. You can remove them and write all the <code>if</code> condition on a single line if these backslashes are not clear to you. The conditions to meet are:</p>
<ul>
<li>To be inside the world: tank (x,y) location must be between (0,0) and (world width-1,world height-1). Remind that coordinates are always between zero and the size minus one.</li>
<li>Not to be at the location of tower 1. The operator <code>!=</code> means "is different from". So, <code>newTankPos != self.tower1Pos</code> means "the new tank location is different from the location of the first tower`.</li>
<li>Not to be at the location of tower 2.</li>
</ul>
<h2>Final program</h2>
<p><a href="https://www.patternsgameprog.com/discover-python-and-patterns-14-collisions/discover_python_patterns_14_collisions.zip">Download code &amp; assets</a></p>
<p>This first solution works fine because we only have two towers. If we want to add more or to have a variable number of them, it will not work. In the <a href="https://www.patternsgameprog.com/discover-python-and-patterns-15-lists/">next post</a>, I'll show you how to use lists to deal with any number of towers.</p>
	<!-- Begin Footer
	================================================== -->
	<div class="footer">
		<p class="pull-left">
			 Copyright &copy; 2020-2023 https://www.patternsgameprog.com
		</p>
		<p class="pull-right">
			<a href="https://twitter.com/umlgameprog?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @umlgameprog</a></script>
		</p>
		<div class="clearfix">
		</div>
	</div>
	<!-- End Footer
	================================================== -->

</div>
<!-- /.container -->

<!-- Bootstrap core JavaScript
    ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://www.patternsgameprog.com/assets/js/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://www.patternsgameprog.com/assets/js/bootstrap.min.js"></script>
<script src="https://www.patternsgameprog.com/assets/js/ie10-viewport-bug-workaround.js"></script>
<script src="https://www.patternsgameprog.com/assets/js/mediumish.js"></script>
</body>
</html>