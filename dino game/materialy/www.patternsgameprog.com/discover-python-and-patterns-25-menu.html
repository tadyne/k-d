<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" href="https://www.patternsgameprog.com/discover-python-and-patterns-25-menu" />
<meta name="description" content="Create a game menu with Python and Pygame.">
<meta name="author" content="Philippe-Henri Gosselin">
<meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' />
<link rel="icon" href="assets/img/favicon.ico">
<title>Design Patterns and Video Games</title>
<link href="https://www.patternsgameprog.com/assets/css/bootstrap.min.css" rel="stylesheet">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Righteous" rel="stylesheet">
<link href="https://www.patternsgameprog.com/assets/css/mediumish.css" rel="stylesheet">
<link href="https://www.patternsgameprog.com/assets/css/darcula.css" rel="stylesheet">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150349446-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150349446-1');
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NB1HVSF9XH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NB1HVSF9XH');
</script>

<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

</head>
<body>

<!-- Begin Nav
================================================== -->
<nav class="navbar navbar-toggleable-md navbar-light bg-white fixed-top mediumnavigation">
<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon"></span>
</button>
<div class="container">
	<a class="navbar-brand" href="https://www.patternsgameprog.com">
	Design Patterns and Video Games
	</a>
	
	<div class="collapse navbar-collapse" id="navbarsExampleDefault">
		<ul class="navbar-nav ml-auto">
						<li class="nav-item">
			<a class="nav-link" href="https://www.patternsgameprog.com/series">Series</a>
			</li>
						<li class="nav-item">
			<a class="nav-link" href="https://www.patternsgameprog.com/more">More</a>
			</li>
						<li class="nav-item">
			<a class="nav-link" href="https://www.patternsgameprog.com/about">About</a>
			</li>
									
		</ul>
	</div>
</div>
</nav>
<!-- End Nav
================================================== -->



<div class="container">
	<div class="mainheading">
		<img class="featured-image img-fluid" src="https://www.patternsgameprog.com/assets/img/header.png" alt="Design Patterns and Video Games">
	</div>
<!-- End Site Title
================================================== -->

	<div class="section-title">
		<h2><span>Discover Python and Patterns (25): Menu</span></h2>
	</div>

<p>In this post, I show how to create a menu with Pygame, using the Game Loop pattern.</p>
<p><em>This post is part of the <a href="https://www.patternsgameprog.com/series/discover-python-and-patterns/">Discover Python and Patterns series</a></em></p>
<h2>Objective</h2>
<p>We create a new program (independent from the previous one) that implements a game menu:</p>
<!-- Video Player -->
<figure><video controls="controls" height="90%" poster="https://www.patternsgameprog.com/media/pages/discover-python-and-patterns-25-menu/02d882814b-1622751567/25_menu.mp4.jpg" preload="preload" width="90%"><source src="https://www.patternsgameprog.com/media/pages/discover-python-and-patterns-25-menu/add58e5f72-1621710969/25_menu.mp4" type="video/mp4"><a href="https://www.patternsgameprog.com/media/pages/discover-python-and-patterns-25-menu/add58e5f72-1621710969/25_menu.mp4"><img src="https://www.patternsgameprog.com/media/pages/discover-python-and-patterns-25-menu/02d882814b-1622751567/25_menu.mp4.jpg"></a></source></video></figure>
<h2>Game Loop pattern</h2>
<p>I create the menu following the Game Loop pattern. This approach allows us to use it later inside our game. I create the following class that embeds all that we need to create the menu:</p>
<figure><img alt="Menu class" class="centered-image img-fluid" src="https://www.patternsgameprog.com/media/pages/discover-python-and-patterns-25-menu/8891b05b4f-1621710969/25_menu.png" width="258"></figure>
<p>Attributes:</p>
<ul>
<li><code>window</code>: a Pygame window;</li>
<li><code>titleFont</code> and <code>itemFont</code>: Pygame fonts for the title and menu items;</li>
<li><code>menuItems</code>: the content of the menu (more details below);</li>
<li><code>currentMenuItem</code>: the index of the currently selected menu item;</li>
<li><code>menuCursor</code>: a Pygame surface for the menu cursor (a tank pointing to the currently selected item);</li>
<li><code>clock</code>: a Pygame clock to limit the frame rate (60Hz);</li>
<li><code>running</code>: <code>True</code> until the end of the program.</li>
</ul>
<p>Methods:</p>
<ul>
<li><code>init()</code>: the initialization method called once. We create the window, the fonts, the menu items, and the variables that describe the current state of the menu;</li>
<li><code>loadLevel()</code>: we call it when the player selects a level in the menu. For now, it only displays a message in the console;</li>
<li><code>exitMenu()</code>: we call it when the player selects the <code>Quit</code> menu item. It sets the <code>running</code> attribute to <code>False</code>;</li>
<li><code>processInput()</code>: parses Pygame events to find key presses and act accordingly. Up/Down arrow keys increase/decrease <code>currentMenuItem</code> and Return key triggers the action corresponding to the currently selected item;</li>
<li><code>update()</code>: does nothing because the menu is so simple that we don't need to follow the Command pattern. It is better to create it anyway, in case our game evolves and we need more advanced features;</li>
<li><code>render()</code>: renders the menu;</li>
<li><code>run()</code>: the main game loop.</li>
</ul>
<h2>Representing the menu items</h2>
<p>I store all the menu item data using several interesting features of the Python language:</p>
<pre class="hljs"><code>self.menuItems = [
    {
        <span class="hljs-string">'title'</span>: <span class="hljs-string">'Level 1'</span>,
        <span class="hljs-string">'action'</span>: <span class="hljs-keyword">lambda</span>: self.loadLevel(<span class="hljs-string">"level1.tmx"</span>)
    },
    {
        <span class="hljs-string">'title'</span>: <span class="hljs-string">'Level 2'</span>,
        <span class="hljs-string">'action'</span>: <span class="hljs-keyword">lambda</span>: self.loadLevel(<span class="hljs-string">"level2.tmx"</span>)
    },
    {
        <span class="hljs-string">'title'</span>: <span class="hljs-string">'Quit'</span>,
        <span class="hljs-string">'action'</span>: <span class="hljs-keyword">lambda</span>: self.exitMenu()
    }
]</code></pre>
<p>First of all, the <code>menuItems</code> attribute is a list, because we start it and end with brackets <code>[]</code>. A comma separates each item of this list:</p>
<pre class="hljs"><code>self.menuItems = [ item1, item2, ... ]</code></pre>
<p>Each item of the list is a dictionary because of the braces <code>{}</code>. For instance, the first item is:</p>
<pre class="hljs"><code>{
    <span class="hljs-string">'title'</span>: <span class="hljs-string">'Level 1'</span>,
    <span class="hljs-string">'action'</span>: <span class="hljs-keyword">lambda</span>: self.loadLevel(<span class="hljs-string">"level1.tmx"</span>)
}</code></pre>
<p>Like we saw before, each element of the dictionary has a unique key. In this example, the first key is 'title' and the second one is 'action'. We could update the content of this first menu item in the following way:</p>
<pre class="hljs"><code>self.menuItems[<span class="hljs-number">0</span>][<span class="hljs-string">'title'</span>] = <span class="hljs-string">'Level 1'</span>
self.menuItems[<span class="hljs-number">0</span>][<span class="hljs-string">'action'</span>] = <span class="hljs-keyword">lambda</span>: self.loadLevel(<span class="hljs-string">"level1.tmx"</span>)</code></pre>
<p>As you can see, you can stack indices: <code>[0]</code> is the index of the first item in the <code>menuItems</code> attribute, and <code>['title']</code> is the index of the "title" item in the <code>self.menuItems[0]</code> dictionary.</p>
<p>About values, the one of 'title' is the message to display for the menu item. The one of 'action' is new: it is a lambda function. It is the function to call when the player asks for its execution.</p>
<p>Lambda functions are powerful features available in most programming languages. They allow the creation of anonymous inline functions. Without lambdas, you must create a function and find a unique name:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">loadLevel1</span><span class="hljs-params">()</span>:</span>
    menu.loadLevel(<span class="hljs-string">"level1.tmx"</span>)
self.menuItems[<span class="hljs-number">0</span>][<span class="hljs-string">'action'</span>] = loadLevel1</code></pre>
<p>As you can see, we save several code lines and get a clear syntax. Moreover, it can transparently embed variables, in which case the lambda is a <em>closure</em>. In this example, the function automatically embedded the <code>self</code> variable. It means that, when you call the lambda, it knows who is <code>self</code>, and it correctly refers to the menu instance.</p>
<h2>The init() method</h2>
<p>This method initializes the menu:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
    <span class="hljs-comment"># Windows</span>
    pygame.init()
    self.window = pygame.display.set_mode((<span class="hljs-number">1280</span>, <span class="hljs-number">720</span>))
    pygame.display.set_caption(<span class="hljs-string">"Discover Python &amp; Patterns - https://www.patternsgameprog.com"</span>)
    pygame.display.set_icon(pygame.image.load(<span class="hljs-string">"icon.png"</span>))

    <span class="hljs-comment"># Font</span>
    self.titleFont = pygame.font.Font(<span class="hljs-string">"BD_Cartoon_Shout.ttf"</span>, <span class="hljs-number">72</span>)
    self.itemFont = pygame.font.Font(<span class="hljs-string">"BD_Cartoon_Shout.ttf"</span>, <span class="hljs-number">48</span>)

    <span class="hljs-comment"># Menu items</span>
    self.menuItems = [
        {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'Level 1'</span>,
            <span class="hljs-string">'action'</span>: <span class="hljs-keyword">lambda</span>: self.loadLevel(<span class="hljs-string">"level1.tmx"</span>)
        },
        {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'Level 2'</span>,
            <span class="hljs-string">'action'</span>: <span class="hljs-keyword">lambda</span>: self.loadLevel(<span class="hljs-string">"level2.tmx"</span>)
        },
        {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'Quit'</span>,
            <span class="hljs-string">'action'</span>: <span class="hljs-keyword">lambda</span>: self.exitMenu()
        }
    ]
    self.currentMenuItem = <span class="hljs-number">0</span>
    self.menuCursor = pygame.image.load(<span class="hljs-string">"cursor.png"</span>)        

    <span class="hljs-comment"># Loop properties</span>
    self.clock = pygame.time.Clock()
    self.running = <span class="hljs-literal">True</span> </code></pre>
<p>Lines 3-6 create the window and set an icon like we did it previously.</p>
<p>Lines 9-10 create Pygame fonts for the title and the menu items. Note that I load a file "BD_Cartoon_Shout.ttf" in the game assets rather than using a system font. It is safer, and we are sure of the final rendering. I downloaded the font on <a href="https://www.dafont.com">https://www.dafont.com</a>; it is free for use for any purpose.</p>
<p>Lines 13-26 initialize the game menu, as presented in the previous section.</p>
<p>Line 27 sets the currently selected menu item on the first one. Remind that indices start at 0!</p>
<p>Line 28 loads an image for the menu cursor (a tank pointing to the right).</p>
<p>Lines 31-32 create a Pygame clock to limit the frame rate and a running variable to stop the main loop.</p>
<h2>The processInput() method</h2>
<p>This method parses the Pygame events list to move the cursor and trigger menu actions:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">processInput</span><span class="hljs-params">(self)</span>:</span>
    <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> pygame.event.get():
        <span class="hljs-keyword">if</span> event.type == pygame.QUIT:
            self.exitMenu()
            <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">elif</span> event.type == pygame.KEYDOWN:
            <span class="hljs-keyword">if</span> event.key == pygame.K_DOWN:
                <span class="hljs-keyword">if</span> self.currentMenuItem &lt; len(self.menuItems) - <span class="hljs-number">1</span>:
                    self.currentMenuItem += <span class="hljs-number">1</span>
            <span class="hljs-keyword">elif</span> event.key == pygame.K_UP:
                <span class="hljs-keyword">if</span> self.currentMenuItem &gt; <span class="hljs-number">0</span>:
                    self.currentMenuItem -= <span class="hljs-number">1</span>
            <span class="hljs-keyword">elif</span> event.key == pygame.K_RETURN:
                menuItem = self.menuItems[self.currentMenuItem]
                <span class="hljs-keyword">try</span>:
                    menuItem[<span class="hljs-string">'action'</span>]()
                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> ex:
                    print(ex) </code></pre>
<p>Lines 3-5 call the <code>exitMenu()</code> method if the QUIT event is triggered (for instance, if the user clicks the close button of the window).</p>
<p>Lines 7-12 handle arrows keys and update the <code>currentMenuItem</code> attribute accordingly.</p>
<p>Lines 14-18 are the most interesting. If the player presses the return key, the <code>menuItem</code> refers to the currently selected menu item (line 14). Line 16 calls the function stored in the 'action' key of this menu. We could write it with an intermediate variable:</p>
<pre class="hljs"><code>actionFunction = menuItem[<span class="hljs-string">'action'</span>]
actionFunction()</code></pre>
<p>Note that <code>actionFunction</code> as well as <code>menuItem['action']</code> don't contain the function. As for objects, they <em>refer</em> to the function. These lines never copy any function, only references.</p>
<p>A <code>try...except</code> block surrounds line 16. Thanks to this syntax, if an error occurs, then Python executes the block following the <code>except</code> statement. In this example, we print the message of the exception (line 18) to help us find the bug. Note that the error can occur anywhere inside the block. It includes inside a function, or inside a function called by a function, etc. In all cases, execution stops and goes straight to the block following the <code>except</code> statement.</p>
<h2>The render() method</h2>
<p>This method renders the menu:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">render</span><span class="hljs-params">(self)</span>:</span>
    self.window.fill((<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))

    <span class="hljs-comment"># Initial y</span>
    y = <span class="hljs-number">50</span>

    <span class="hljs-comment"># Title</span>
    surface = self.titleFont.render(<span class="hljs-string">"TANK BATTLEGROUNDS !!"</span>, <span class="hljs-literal">True</span>, (<span class="hljs-number">200</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))
    x = (self.window.get_width() - surface.get_width()) // <span class="hljs-number">2</span>
    self.window.blit(surface, (x, y))
    y += (<span class="hljs-number">200</span> * surface.get_height()) // <span class="hljs-number">100</span>


    <span class="hljs-comment"># Compute menu width</span>
    menuWidth = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> self.menuItems:
        surface = self.itemFont.render(item[<span class="hljs-string">'title'</span>], <span class="hljs-literal">True</span>, (<span class="hljs-number">200</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))
        menuWidth = max(menuWidth, surface.get_width())
        item[<span class="hljs-string">'surface'</span>] = surface

    <span class="hljs-comment"># Draw menu items</span>
    x = (self.window.get_width() - menuWidth) // <span class="hljs-number">2</span>
    <span class="hljs-keyword">for</span> index, item <span class="hljs-keyword">in</span> enumerate(self.menuItems):
        <span class="hljs-comment"># Item text</span>
        surface = item[<span class="hljs-string">'surface'</span>]
        self.window.blit(surface, (x, y))

        <span class="hljs-comment"># Cursor</span>
        <span class="hljs-keyword">if</span> index == self.currentMenuItem:
            cursorX = x - self.menuCursor.get_width() - <span class="hljs-number">10</span>
            cursorY = y + (surface.get_height() - self.menuCursor.get_height()) // <span class="hljs-number">2</span>
            self.window.blit(self.menuCursor, (cursorX, cursorY))

        y += (<span class="hljs-number">120</span> * surface.get_height()) // <span class="hljs-number">100</span>           


    pygame.display.update()    </code></pre>
<h3>Preparation</h3>
<p>We first erase the window content (line 2).</p>
<p>We use a <code>y</code> variable to store the current height of the menu (line 5). We draw from top (low <code>y</code> values) to bottom (high <code>y</code>values).</p>
<h3>Draw the title</h3>
<p>Lines 8-11 in the <code>render()</code> method draw the title:</p>
<pre class="hljs"><code>surface = self.titleFont.render(<span class="hljs-string">"TANK BATTLEGROUNDS !!"</span>, <span class="hljs-literal">True</span>, (<span class="hljs-number">200</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))
x = (self.window.get_width() - surface.get_width()) // <span class="hljs-number">2</span>
self.window.blit(surface, (x, y))
y += (<span class="hljs-number">200</span> * surface.get_height()) // <span class="hljs-number">100</span></code></pre>
<p>The first line creates a Pygame surface with the text "TANK BATTLEGROUNDS !!" rendered with antialiasing (<code>True</code>) and with a red color (200, 0, 0).</p>
<p>The second line computes the <code>x</code> coordinate that centers this text on the screen. It is a common computation: (total_size - object_size) divided by 2. Here, the total size is the width of the window <code>self.window.get_width()</code>, and the size of the object is the width of the surface that contains the text <code>surface.get_width()</code>. The <code>//</code> symbol is the integer division (otherwise, we would get a float value).</p>
<p>The third line blits the surface with the text.</p>
<p>The last line updates the height of the menu so that the next texts are below. The computation is an integer percentage computation. In this line, I compute 200% of the text height. You can simplify it to a multiplication by 2, but it won't speed up the computation, most compilers do it by themselves. I let it in this form, in case I change my mind. If I want to change it, I only have to replace the 200 in the expression.</p>
<h3>Compute the menu width</h3>
<p>Lines 15-19 computes the width of the menu. We need this width to center the menu:</p>
<pre class="hljs"><code>menuWidth = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> self.menuItems:
    surface = self.itemFont.render(item[<span class="hljs-string">'title'</span>], <span class="hljs-literal">True</span>, (<span class="hljs-number">200</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))
    menuWidth = max(menuWidth, surface.get_width())
    item[<span class="hljs-string">'surface'</span>] = surface</code></pre>
<p>The menu width is initialized to 0 (first line).</p>
<p>Then, we iterate through the menu (second line).</p>
<p>We render the text of the menu item into a Pygame surface (third line).</p>
<p>We keep the maximum value between the current menu width and the surface width (fourth line).</p>
<p>Finally, we save the surface in the menu item (fifth line). This last step is not mandatory; this is to save some computations and avoid the re-rendering of the text in the next loop.</p>
<h3>Draw the menu items</h3>
<p>Lines 22-34 draw the menu items:</p>
<pre class="hljs"><code>x = (self.window.get_width() - menuWidth) // <span class="hljs-number">2</span>
<span class="hljs-keyword">for</span> index, item <span class="hljs-keyword">in</span> enumerate(self.menuItems):
    <span class="hljs-comment"># Item text</span>
    surface = item[<span class="hljs-string">'surface'</span>]
    self.window.blit(surface, (x, y))

    <span class="hljs-comment"># Cursor</span>
    <span class="hljs-keyword">if</span> index == self.currentMenuItem:
        cursorX = x - self.menuCursor.get_width() - <span class="hljs-number">10</span>
        cursorY = y + (surface.get_height() - self.menuCursor.get_height()) // <span class="hljs-number">2</span>
        self.window.blit(self.menuCursor, (cursorX, cursorY))

    y += (<span class="hljs-number">120</span> * surface.get_height()) // <span class="hljs-number">100</span> </code></pre>
<p>The first line computes an x coordinates so that the menu is centered. It is the same formula as the one we saw for centering the title.</p>
<p>The second line iterates through the menu items using <code>enumerate</code>. This statement provides the index of each item of a list in addition to the items.</p>
<p>The two first lines of the for block draws the current menu item. Since we saved a surface in the previous loop, we don't need to re-compute it.</p>
<p>The next group of lines draws the menu cursor if the item is the currently selected one. We draw the cursor left to the item text and center it vertically.</p>
<p>The last line of the for block increases the current menu height by 120% of the menu item height.</p>
<h2>Final code</h2>
<p><a href="https://www.patternsgameprog.com/discover-python-and-patterns-25-menu/discover_python_and_patterns_25_menu.zip">Download code and assets</a></p>
<p>When running the program from Spyder, click the <strong>Run / Configuration per file</strong> menu item. In the <strong>Console </strong>group, select <strong>Execute in an external system terminal</strong>. In the <strong>General settings</strong> group, check <strong>Remove all variables before execution</strong>. Sometimes Pygame has trouble creating fonts, and these options can resolve the issue.</p>
<figure><img alt="Spyder run in external terminal" class="centered-image img-fluid" src="https://www.patternsgameprog.com/media/pages/discover-python-and-patterns-25-menu/c1285c29a8-1621710970/26_spyder.png" width="392"></figure>
<p>In the <a href="https://www.patternsgameprog.com/discover-python-and-patterns-26-game-modes/">next post</a>, we'll merge this program with the main one to get a menu inside our game.</p>
	<!-- Begin Footer
	================================================== -->
	<div class="footer">
		<p class="pull-left">
			 Copyright &copy; 2020-2023 https://www.patternsgameprog.com
		</p>
		<p class="pull-right">
			<a href="https://twitter.com/umlgameprog?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @umlgameprog</a></script>
		</p>
		<div class="clearfix">
		</div>
	</div>
	<!-- End Footer
	================================================== -->

</div>
<!-- /.container -->

<!-- Bootstrap core JavaScript
    ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://www.patternsgameprog.com/assets/js/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://www.patternsgameprog.com/assets/js/bootstrap.min.js"></script>
<script src="https://www.patternsgameprog.com/assets/js/ie10-viewport-bug-workaround.js"></script>
<script src="https://www.patternsgameprog.com/assets/js/mediumish.js"></script>
</body>
</html>