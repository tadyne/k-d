<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" href="https://www.patternsgameprog.com/discover-python-and-patterns-8-game-loop-pattern" />
<meta name="description" content="The Game Loop pattern with Python.">
<meta name="author" content="Philippe-Henri Gosselin">
<meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' />
<link rel="icon" href="assets/img/favicon.ico">
<title>Design Patterns and Video Games</title>
<link href="https://www.patternsgameprog.com/assets/css/bootstrap.min.css" rel="stylesheet">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Righteous" rel="stylesheet">
<link href="https://www.patternsgameprog.com/assets/css/mediumish.css" rel="stylesheet">
<link href="https://www.patternsgameprog.com/assets/css/darcula.css" rel="stylesheet">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150349446-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150349446-1');
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NB1HVSF9XH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NB1HVSF9XH');
</script>

<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

</head>
<body>

<!-- Begin Nav
================================================== -->
<nav class="navbar navbar-toggleable-md navbar-light bg-white fixed-top mediumnavigation">
<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon"></span>
</button>
<div class="container">
	<a class="navbar-brand" href="https://www.patternsgameprog.com">
	Design Patterns and Video Games
	</a>
	
	<div class="collapse navbar-collapse" id="navbarsExampleDefault">
		<ul class="navbar-nav ml-auto">
						<li class="nav-item">
			<a class="nav-link" href="https://www.patternsgameprog.com/series">Series</a>
			</li>
						<li class="nav-item">
			<a class="nav-link" href="https://www.patternsgameprog.com/more">More</a>
			</li>
						<li class="nav-item">
			<a class="nav-link" href="https://www.patternsgameprog.com/about">About</a>
			</li>
									
		</ul>
	</div>
</div>
</nav>
<!-- End Nav
================================================== -->



<div class="container">
	<div class="mainheading">
		<img class="featured-image img-fluid" src="https://www.patternsgameprog.com/assets/img/header.png" alt="Design Patterns and Video Games">
	</div>
<!-- End Site Title
================================================== -->

	<div class="section-title">
		<h2><span>Discover Python and Patterns (8): Game Loop pattern</span></h2>
	</div>

<p>The time has come to see our first design pattern: the Game Loop Pattern! This pattern can give us many good ideas to refactor our game in a very effective way.</p>
<p><em>This post is part of the <a href="https://www.patternsgameprog.com/series/discover-python-and-patterns/">Discover Python and Patterns series</a></em>  </p>
<h2>The Game Loop pattern</h2>
<p>There is several version of the Game Loop pattern. Here I present a simple case with a single thread. The following 5 functions form this pattern:</p>
<figure><img alt="The Game Loop pattern" class="centered-image img-fluid" src="https://www.patternsgameprog.com/media/pages/discover-python-and-patterns-8-game-loop-pattern/5c9cf4c3c9-1621704758/08_gameloop.png" width="150"></figure>
<ul>
<li>The <code>init()</code> function is called at startup to initialize the game and its data. In the following, I name this data the <em>game state</em>.</li>
<li>The <code>processInput()</code> function is called at each iteration of the game to manage the controls (keyboard, mouse, pad).</li>
<li>The <code>update()</code> function changes the game state. The result of <code>processInput()</code> is used to update the game state, as well as automatic processes.</li>
<li>The <code>render()</code> function handles display. It "convert" the game state into visual content.</li>
<li>The <code>run()</code> function contains the game loop. In many cases, this loop looks like this one:</li>
</ul>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">()</span>:</span>
    init()
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        processInput()
        update()
        render()</code></pre>
<p>The Game Loop pattern, as for all patterns, is a recipe that gives you ideas on how to solve a problem. There is no unique way to use it: it depends on cases.</p>
<p>Following a pattern forces you to consider problems you may not be thinking about. For instance, splitting user input, data updates, and rendering is not the first thing that came to mind when we created the "guess the number" game. However, according to experimented developers that already created many games, it seems that this splitting is essential. So, right now as beginners, we follow this advice, and later we will understand why it matters. And please trust me: the day you see it all, you will get amazed by all the genius behind these ideas!</p>
<h2>Guess the number game: init() function</h2>
<p>Let's start using the pattern with the <code>init()</code> function:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init</span><span class="hljs-params">()</span>:</span>    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, random.randint(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>)</code></pre>
<p>This function returns an initial game state. I named game data "the game state" because games can be seen as finite state machines. For this game, the state is made of:</p>
<ul>
<li>
<p>The game status: this is the general status of the game, represented by a string:</p>
<ul>
<li>"win": the player wins and the game is over;</li>
<li>"end": the player leaves the game;</li>
<li>"lower": the player is still playing, and proposed a number lower than the magic one;</li>
<li>"higher": same but for a higher number.</li>
</ul>
</li>
<li>
<p>The magic number: the number the player has to find.</p>
</li>
</ul>
<p>Bundle all game data is an important task; we'll see that with more details in the next posts.</p>
<h2>Guess the number game: processInput() function</h2>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">processInput</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        word = input(<span class="hljs-string">"What is the magic number? "</span>)
        <span class="hljs-keyword">if</span> word == <span class="hljs-string">"quit"</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

        <span class="hljs-keyword">try</span>:
            playerNumber = int(word)
            <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">except</span> ValueError:
            print(<span class="hljs-string">"Please type a number without decimals!"</span>)
            <span class="hljs-keyword">continue</span>

    <span class="hljs-keyword">return</span> playerNumber</code></pre>
<p>This function asks the player for a number. It handles all problems related to user input, like checking that the entered number is correct. It returns the number, or <code>None</code> if the player wants to stop the game.</p>
<p>For users of this function, like the <code>run()</code> function, it is like a magic box that returns instructions from the player. It does not matter how they are collected. It could be from a keyboard, a mouse, a pad, the network, or even from an AI.</p>
<h2>Guess the number game: update() function</h2>
<p>The <code>update()</code> function updates the game state using the player's instructions:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(gameStatus,magicNumber,playerNumber)</span>:</span>
    <span class="hljs-keyword">if</span> playerNumber <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        gameStatus = <span class="hljs-string">"end"</span>
    <span class="hljs-keyword">elif</span> playerNumber == magicNumber:
        gameStatus = <span class="hljs-string">"win"</span>
    <span class="hljs-keyword">elif</span> magicNumber &lt; playerNumber:
        gameStatus = <span class="hljs-string">"lower"</span>
    <span class="hljs-keyword">elif</span> magicNumber &gt; playerNumber:
        gameStatus = <span class="hljs-string">"higher"</span>

    <span class="hljs-keyword">return</span> gameStatus, magicNumber </code></pre>
<p>In our case, the player's instruction is <code>playerNumber</code>, and the game status and the magic number form the game state. The function updates the game status depending on the value of <code>playerNumber</code>.</p>
<p>Note that we don't use <code>gameStatus</code> as an input, and never change the value of <code>magicNumber</code>. So, we could think that we can remove <code>gameStatus</code> from the arguments and <code>magicNumber</code> from the return values. Except if this is the very last version of this game and that we must reduce computational complexity, this is not a good idea. Maybe in future improvements of the game, we will need to update the game according to <code>gameStatus</code> or change the value of <code>magicNumber</code>. From a design point of view, this current definition of inputs and outputs is robust and has no reason to change.</p>
<h2>Guess the number game: render() function</h2>
<p>The render() function displays the current game state. It should work whatever happens, to always give a clear view of the game:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">render</span><span class="hljs-params">(gameStatus,magicNumber)</span>:</span>
    <span class="hljs-keyword">if</span> gameStatus == <span class="hljs-string">"win"</span>:
        print(<span class="hljs-string">"This is correct! You win!"</span>)
    <span class="hljs-keyword">elif</span> gameStatus == <span class="hljs-string">"end"</span>:
        print(<span class="hljs-string">"Bye!"</span>)
    <span class="hljs-keyword">elif</span> gameStatus == <span class="hljs-string">"lower"</span>:
        print(<span class="hljs-string">"The magic number is lower"</span>)
    <span class="hljs-keyword">elif</span> gameStatus == <span class="hljs-string">"higher"</span>:
        print(<span class="hljs-string">"The magic number is higher"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"Unexpected game status {}"</span>.format(gameStatus))</code></pre>
<p>The input of this function is the game state and has no output. The process is simple: display a message according to the value of <code>gameStatus</code>.</p>
<p>Note that we also handle the case where <code>gameStatus</code> has an unexpected value. It is a good habit, it greatly helps the day you update the game and forget to update some parts.</p>
<h2>Guess the number game: runGame() function</h2>
<p>The <code>runGame()</code> function is the core of the game and uses all the previous functions:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">runGame</span><span class="hljs-params">()</span>:</span>
    gameStatus, magicNumber = init()
    <span class="hljs-keyword">while</span> gameStatus != <span class="hljs-string">"win"</span> <span class="hljs-keyword">and</span> gameStatus != <span class="hljs-string">"end"</span>:
        playerNumber = processInput()
        gameStatus, magicNumber = update(gameStatus,magicNumber,playerNumber)
        render(gameStatus,magicNumber)</code></pre>
<p>You can see the flow:</p>
<ul>
<li>The <code>init()</code> function returns an initial game state;</li>
<li>The <code>processInput()</code> function collects instructions from the player;</li>
<li>The <code>update()</code> function uses the instructions to update the game state;</li>
<li>The <code>render()</code> function displays the game state.</li>
</ul>
<h2>Guess the number game: final code</h2>
<p>The final code, with documentation in function headers:</p>
<pre class="hljs"><code><span class="hljs-comment"># Import the random package</span>
<span class="hljs-keyword">import</span> random

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-string">"""
    Initialize game

    Outputs:
      * gameStatus
      * magicNumber
    """</span>
    <span class="hljs-comment"># Generate a random Magic number</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, random.randint(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">processInput</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-string">"""
    Handle player's input

    Output:
      * playerNumber: the number entered by the player, or None if the player wants to stop the game
    """</span>

    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-comment"># Player input</span>
        word = input(<span class="hljs-string">"What is the magic number? "</span>)
        <span class="hljs-comment"># Quit if the player types "quit"</span>
        <span class="hljs-keyword">if</span> word == <span class="hljs-string">"quit"</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

        <span class="hljs-comment"># Int casting with exception handling</span>
        <span class="hljs-keyword">try</span>:
            playerNumber = int(word)
            <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">except</span> ValueError:
            print(<span class="hljs-string">"Please type a number without decimals!"</span>)
            <span class="hljs-keyword">continue</span>

    <span class="hljs-keyword">return</span> playerNumber

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(gameStatus,magicNumber,playerNumber)</span>:</span>
    <span class="hljs-string">"""
    Update game state

    Inputs:
      * gameStatus: the status of the game
      * magicNumber: the magic number to find
      * playerNumber: the number entered by the player
    Output:
      * gameStatus: the status of the game
      * magicNumber: the magic number to find
    """</span>
    <span class="hljs-keyword">if</span> playerNumber <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        gameStatus = <span class="hljs-string">"end"</span>
    <span class="hljs-keyword">elif</span> playerNumber == magicNumber:
        gameStatus = <span class="hljs-string">"win"</span>
    <span class="hljs-keyword">elif</span> magicNumber &lt; playerNumber:
        gameStatus = <span class="hljs-string">"lower"</span>
    <span class="hljs-keyword">elif</span> magicNumber &gt; playerNumber:
        gameStatus = <span class="hljs-string">"higher"</span>

    <span class="hljs-keyword">return</span> gameStatus, magicNumber

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">render</span><span class="hljs-params">(gameStatus,magicNumber)</span>:</span>
    <span class="hljs-string">"""
    Render game state

    Input:
      * gameStatus: the status of the game, "win", "end", "lower" or "higher"
    """</span>
    <span class="hljs-comment"># Cases</span>
    <span class="hljs-keyword">if</span> gameStatus == <span class="hljs-string">"win"</span>:
        print(<span class="hljs-string">"This is correct! You win!"</span>)
    <span class="hljs-keyword">elif</span> gameStatus == <span class="hljs-string">"end"</span>:
        print(<span class="hljs-string">"Bye!"</span>)
    <span class="hljs-keyword">elif</span> gameStatus == <span class="hljs-string">"lower"</span>:
        print(<span class="hljs-string">"The magic number is lower"</span>)
    <span class="hljs-keyword">elif</span> gameStatus == <span class="hljs-string">"higher"</span>:
        print(<span class="hljs-string">"The magic number is higher"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"Unexpected game status {}"</span>.format(gameStatus))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">runGame</span><span class="hljs-params">()</span>:</span>
    gameStatus, magicNumber = init()
    <span class="hljs-keyword">while</span> gameStatus != <span class="hljs-string">"win"</span> <span class="hljs-keyword">and</span> gameStatus != <span class="hljs-string">"end"</span>:
        playerNumber = processInput()
        gameStatus, magicNumber = update(gameStatus,magicNumber,playerNumber)
        render(gameStatus,magicNumber)


<span class="hljs-comment"># Launch the game</span>
runGame()</code></pre>
<p>Now we saw the essential basics, in the <a href="https://www.patternsgameprog.com/discover-python-and-patterns-9-pygame/">next post</a> I'll be able to show you how to use game graphics :)</p>
	<!-- Begin Footer
	================================================== -->
	<div class="footer">
		<p class="pull-left">
			 Copyright &copy; 2020-2023 https://www.patternsgameprog.com
		</p>
		<p class="pull-right">
			<a href="https://twitter.com/umlgameprog?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @umlgameprog</a></script>
		</p>
		<div class="clearfix">
		</div>
	</div>
	<!-- End Footer
	================================================== -->

</div>
<!-- /.container -->

<!-- Bootstrap core JavaScript
    ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://www.patternsgameprog.com/assets/js/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://www.patternsgameprog.com/assets/js/bootstrap.min.js"></script>
<script src="https://www.patternsgameprog.com/assets/js/ie10-viewport-bug-workaround.js"></script>
<script src="https://www.patternsgameprog.com/assets/js/mediumish.js"></script>
</body>
</html>